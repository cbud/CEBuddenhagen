{
  "hash": "6bda4faa0fdbd7a8f29d47494bfae490",
  "result": {
    "markdown": "---\ntitle: \"Sankey diagram example data and code\"\nauthor: \"Christopher Buddenhagen\"\ndate: \"2022-09-9\"\ncategories: [news, code, analysis,network]\nimage: \"sankey.png\"\nbibliography: references.bib\ncsl: new-zealand-plant-protection (CEB).csl\nexexute:\n  freeze: auto\neditor: \n  markdown: \n    wrap: 72\n---\n\n\nI first learned about a Sankey graph from Tufte's data visualization\nbook [@tufte1983visual]. It is a heartbreaking image of Napoleon's army's\nattempt to invade Moscow, but instead of victory, thousands died through\na mix of war and unhygienic and freezing weather as the marched to\nMoscow and back to France. My purposes for this post are much more\nmundane, quite unimportant relatively - to look at weightings of a\nproject with criteria.\n\nHow can data be used to generate a Sankey graph? You need project and\ncriteria node names arranged in terms of weights and the target and\nsources for links @tbl-data. This way nodes and links are sized\naccording the assigned weights @fig-sankey - an example of its\napplication is in my other post for our [weed horizon\nscan](https://cbuddenhagen.quarto.pub/notes-from-a-from-a-plant-biologist/posts/weed-horizon-scan/).\n\n![Charles Joseph Minard's visualization of Napoleon's Russian campaign\nof\n1812](Charles-Joseph-Minards-visualization-of-Napoleons-Russian-campaign-of-1812-Friendly_W640.jpeg)\n\nThe package is a network package\n`networkD3`@allaireNetworkD3D3JavaScript2017.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Load packages\nlibrary(tidyverse)\nlibrary(networkD3)\nlibrary(kableExtra)\n```\n:::\n\n\nThe data can be read in from an external file, you need the nodes to be\nlisted and numbered from 0 and on up to the number of nodes in one file,\nthe names should match the criteria and project titles @tbl-nodes.\n\n\n::: {#tbl-nodes .cell tbl-cap='The nodes need to be numbered from zero up.' tbl-colwidths='[50,50]'}\n\n```{.r .cell-code}\nnodes<-\n  structure(\n  list(\n    source = 0:7, #node numbering starts at zero\n    target_name = c(\n      \"1 project\",\n      \"2 project\",\n      \"3 project\",\n      \"4 project\",\n      \"5 project\",\n      \"Proportion of work that is plant science\",\n      \"Stakeholders will benefit\",\n      \"Is not well addressed by others\"\n    )\n  ),\n  row.names = c(NA,-8L),\n  class = \"data.frame\"\n)\n\nkable(nodes %>% arrange(source), align=\"l\", format = \"pipe\", padding = 2)\n```\n\n::: {.cell-output-display}\n|source  |target_name                               |\n|:-------|:-----------------------------------------|\n|0       |1 project                                 |\n|1       |2 project                                 |\n|2       |3 project                                 |\n|3       |4 project                                 |\n|4       |5 project                                 |\n|5       |Proportion of work that is plant science  |\n|6       |Stakeholders will benefit                 |\n|7       |Is not well addressed by others           |\n:::\n:::\n\n\nGenerate some random weights for this exercise, I am using 3 criteria,\nfor the 5 projects so I need 15 weights.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweights<-sample(1:10, 15, replace=T)\n```\n:::\n\n\nThen generate the table with project names and weights. The link colors\nare determined by the names on the nodes and it can have problems\nrecognizing names as unique if the first word is the same and there are\nspaces. I used Project 1, Project 2, etc and it didn't recognize the\nnodes as distinct until I named them 1 Project, 2 Project, etc.\n\n\n::: {#tbl-data .cell tbl-cap='Data arrangement includes projects, criteria and weights.'}\n\n```{.r .cell-code}\ntarget_source <-\n  tibble(\n    source_name = c(rep(\n      c(\n        \"Proportion of work that is plant science\",\n        \"Stakeholders will benefit\",\n        \"Is not well addressed by others\"\n      ),\n      5\n    )),\n    target_name = c(rep(\n      c(\"1 project\",\n        \"2 project\",\n        \"3 project\",\n        \"4 project\",\n        \"5 project\"),\n      3\n    )),\n    weight=as.numeric(c(weights)),\n    target = c(rep(c(0, 1, 2, 3, 4), 3)),\n    source = c(rep(c(5, 6, 7), 5))\n    \n    ) \n\nkable(target_source %>% arrange(target_name), align=\"c\", format = \"pipe\", padding = 2)\n```\n\n::: {.cell-output-display}\n|                source_name                 |  target_name  |  weight  |  target  |  source  |\n|:------------------------------------------:|:-------------:|:--------:|:--------:|:--------:|\n|  Proportion of work that is plant science  |   1 project   |    3     |    0     |    5     |\n|      Is not well addressed by others       |   1 project   |    9     |    0     |    7     |\n|         Stakeholders will benefit          |   1 project   |    8     |    0     |    6     |\n|         Stakeholders will benefit          |   2 project   |    7     |    1     |    6     |\n|  Proportion of work that is plant science  |   2 project   |    3     |    1     |    5     |\n|      Is not well addressed by others       |   2 project   |    10    |    1     |    7     |\n|      Is not well addressed by others       |   3 project   |    6     |    2     |    7     |\n|         Stakeholders will benefit          |   3 project   |    10    |    2     |    6     |\n|  Proportion of work that is plant science  |   3 project   |    9     |    2     |    5     |\n|  Proportion of work that is plant science  |   4 project   |    7     |    3     |    5     |\n|      Is not well addressed by others       |   4 project   |    4     |    3     |    7     |\n|         Stakeholders will benefit          |   4 project   |    7     |    3     |    6     |\n|         Stakeholders will benefit          |   5 project   |    5     |    4     |    6     |\n|  Proportion of work that is plant science  |   5 project   |    2     |    4     |    5     |\n|      Is not well addressed by others       |   5 project   |    7     |    4     |    7     |\n:::\n:::\n\n\nThen generate the @fig-sankey. Just note it is outputting and html\nwidget, looks a lot better on a desktop screen.\n\n------------------------------------------------------------------------\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsankey3<-networkD3::sankeyNetwork(Links = target_source, \n                                  Nodes = nodes, \n                                  Source = 'target', \n                                  Target = 'source', \n                                  Value = 'weight', \n                                  NodeID = 'target_name',\n                                  units = 'weight',\n                                  width = 600,\n                                  height = 800,\n                                  fontSize = 18,\n                                  LinkGroup=\"target_name\", \n                                  fontFamily = \"Georgia\")\n\nsankey3\n```\n\n::: {#fig-sankey .cell-output-display}\n```{=html}\n<div id=\"htmlwidget-39e620bb78615a3b442f\" style=\"width:100%;height:866px;\" class=\"sankeyNetwork html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-39e620bb78615a3b442f\">{\"x\":{\"links\":{\"source\":[0,1,2,3,4,0,1,2,3,4,0,1,2,3,4],\"target\":[5,6,7,5,6,7,5,6,7,5,6,7,5,6,7],\"value\":[3,7,6,7,5,9,3,10,4,2,8,10,9,7,7],\"group\":[\"1 project\",\"2 project\",\"3 project\",\"4 project\",\"5 project\",\"1 project\",\"2 project\",\"3 project\",\"4 project\",\"5 project\",\"1 project\",\"2 project\",\"3 project\",\"4 project\",\"5 project\"]},\"nodes\":{\"name\":[\"1 project\",\"2 project\",\"3 project\",\"4 project\",\"5 project\",\"Proportion of work that is plant science\",\"Stakeholders will benefit\",\"Is not well addressed by others\"],\"group\":[\"1 project\",\"2 project\",\"3 project\",\"4 project\",\"5 project\",\"Proportion of work that is plant science\",\"Stakeholders will benefit\",\"Is not well addressed by others\"]},\"options\":{\"NodeID\":\"target_name\",\"NodeGroup\":\"target_name\",\"LinkGroup\":\"target_name\",\"colourScale\":\"d3.scaleOrdinal(d3.schemeCategory20);\",\"fontSize\":18,\"fontFamily\":\"Georgia\",\"nodeWidth\":15,\"nodePadding\":10,\"units\":\"weight\",\"margin\":{\"top\":null,\"right\":null,\"bottom\":null,\"left\":null},\"iterations\":32,\"sinksRight\":true}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nProject weights under three criteria using a Sankey diagram, from R code.\n:::\n:::\n\n\n## References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/d3-4.5.0/d3.min.js\"></script>\n<script src=\"../../site_libs/sankey-1/sankey.js\"></script>\n<script src=\"../../site_libs/sankeyNetwork-binding-0.4/sankeyNetwork.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}